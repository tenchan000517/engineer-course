# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«8: Python + FFMPEGã«ã‚ˆã‚‹å‹•ç”»åœ§ç¸®ï¼ˆå¿œç”¨ç·¨ï¼‰

**æ‰€è¦æ™‚é–“**: 60-90åˆ†
**é›£æ˜“åº¦**: â­â­â­â˜†â˜†

---

## ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å­¦ã¶ã“ã¨

- Pythonã®ç’°å¢ƒæ§‹ç¯‰ï¼ˆWindows/Mac/Linuxï¼‰
- FFMPEGã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç¢ºèª
- ä»®æƒ³ç’°å¢ƒï¼ˆvenvï¼‰ã®ä½œæˆã¨ç®¡ç†
- Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã®å‹•ç”»ä¸€æ‹¬åœ§ç¸®
- åœ§ç¸®å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç¢ºèªã¨æœ€é©åŒ–

---

## ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚´ãƒ¼ãƒ«

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’çµ‚ãˆã‚‹ã¨ã€ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

- âœ… Pythonã®ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆãƒ»ç®¡ç†ã§ãã‚‹
- âœ… FFMPEGã‚’Pythonã‹ã‚‰æ“ä½œã§ãã‚‹
- âœ… è¤‡æ•°ã®å‹•ç”»ã‚’ä¸€æ‹¬ã§åœ§ç¸®ã§ãã‚‹
- âœ… ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å‹•ç”»ã‚µã‚¤ã‚ºã‚’æœ€é©åŒ–ã§ãã‚‹
- âœ… åœ§ç¸®å“è³ªã‚’è‡ªç”±ã«èª¿æ•´ã§ãã‚‹

---

## ãªãœPythonã§å‹•ç”»åœ§ç¸®ï¼Ÿ

### Module 7ã¨ã®é•ã„

**Module 7ï¼ˆåŸºæœ¬ç·¨ï¼‰:**
- ffmpegã‚³ãƒãƒ³ãƒ‰ã‚’ç›´æ¥å®Ÿè¡Œ
- 1ã¤ãšã¤æ‰‹å‹•ã§åœ§ç¸®
- Claude Codeã«æŒ‡ç¤ºã—ã¦å®Ÿè¡Œ

**Module 8ï¼ˆå¿œç”¨ç·¨ï¼‰:**
- Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è‡ªå‹•åŒ–
- è¤‡æ•°ã®å‹•ç”»ã‚’ä¸€æ‹¬åœ§ç¸®
- ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ã¨å†åœ§ç¸®ã‚’è‡ªå‹•åŒ–
- ã‚ˆã‚Šç´°ã‹ã„åˆ¶å¾¡ãŒå¯èƒ½

### ã“ã‚“ãªäººã«ãŠã™ã™ã‚

- å‹•ç”»ãŒ10æœ¬ä»¥ä¸Šã‚ã‚‹
- å®šæœŸçš„ã«å‹•ç”»ã‚’è¿½åŠ ã™ã‚‹
- åœ§ç¸®ä½œæ¥­ã‚’è‡ªå‹•åŒ–ã—ãŸã„
- ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ãŸã„

---

## ã‚¹ãƒ†ãƒƒãƒ—1: Pythonã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª

### 1-1. PythonãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‹ç¢ºèª

**Claude Codeã§å®Ÿè¡Œ:**

```bash
python --version
```

ã¾ãŸã¯

```bash
python3 --version
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**
```
Python 3.10.x
```

### 1-2. PythonãŒãªã„å ´åˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

#### Windows

**æ–¹æ³•1: Microsoft Storeï¼ˆæ¨å¥¨ï¼‰**

1. Microsoft Storeã‚’é–‹ã
2. "Python 3.12"ã§æ¤œç´¢
3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**æ–¹æ³•2: winget**

```bash
winget install Python.Python.3.12
```

#### Mac

```bash
brew install python@3.12
```

#### Linux (Ubuntu/Debian)

```bash
sudo apt update
sudo apt install python3 python3-pip python3-venv
```

### 1-3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª

```bash
python3 --version
pip3 --version
```

ä¸¡æ–¹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ã€‚

---

## ã‚¹ãƒ†ãƒƒãƒ—2: FFMPEGã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 2-1. FFMPEGãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‹ç¢ºèª

```bash
ffmpeg -version
```

ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ã‚¹ã‚­ãƒƒãƒ—ã—ã¦OKã§ã™ã€‚

### 2-2. FFMPEGã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

#### Windows

```bash
winget install ffmpeg
```

#### Mac

```bash
brew install ffmpeg
```

#### Linux (Ubuntu/Debian)

```bash
sudo apt install ffmpeg
```

### 2-3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª

```bash
ffmpeg -version
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**
```
ffmpeg version 6.x.x
```

---

## ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æº–å‚™

### 3-1. scriptsãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«`scripts`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã™ã€‚

**Claude Codeã§å®Ÿè¡Œ:**

```bash
mkdir scripts
cd scripts
```

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ :**
```
my-portfolio/
â”œâ”€â”€ app/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ mov/           # å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒã“ã“ã«ã‚ã‚‹
â”œâ”€â”€ scripts/           # â† æ–°è¦ä½œæˆ
â”‚   â”œâ”€â”€ compress_videos.py
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ã‚¹ãƒ†ãƒƒãƒ—4: ä»®æƒ³ç’°å¢ƒã®ä½œæˆ

### 4-1. ä»®æƒ³ç’°å¢ƒã¨ã¯ï¼Ÿ

**ä»®æƒ³ç’°å¢ƒ**ã¯ã€Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ç‹¬ç«‹ã—ãŸç’°å¢ƒã‚’ä½œã‚‹ä»•çµ„ã¿ã§ã™ã€‚

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç®¡ç†ã§ãã‚‹
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç«¶åˆã‚’é˜²ã’ã‚‹
- ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å½±éŸ¿ã—ãªã„

### 4-2. ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ

**scriptsãƒ•ã‚©ãƒ«ãƒ€å†…ã§å®Ÿè¡Œ:**

```bash
python3 -m venv venv
```

**èª¬æ˜:**
- `python3 -m venv`: ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
- `venv`: ä»®æƒ³ç’°å¢ƒã®åå‰ï¼ˆä»»æ„ã ãŒæ…£ä¾‹çš„ã«`venv`ã‚’ä½¿ã†ï¼‰

**ä½œæˆå¾Œã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ :**
```
scripts/
â”œâ”€â”€ venv/              # â† ä»®æƒ³ç’°å¢ƒãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ bin/           # (Mac/Linux)
â”‚   â”œâ”€â”€ Scripts/       # (Windows)
â”‚   â”œâ”€â”€ lib/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ compress_videos.py
â””â”€â”€ requirements.txt
```

---

## ã‚¹ãƒ†ãƒƒãƒ—5: ä»®æƒ³ç’°å¢ƒã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ

### 5-1. ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã¨ã¯ï¼Ÿ

**ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ**ã™ã‚‹ã¨ã€ä»®æƒ³ç’°å¢ƒå†…ã®Pythonã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä½¿ã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

**é‡è¦:** ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œå‰ã«æ¯å›ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆãŒå¿…è¦ã§ã™ã€‚

### 5-2. ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã‚³ãƒãƒ³ãƒ‰

#### Windows (PowerShell)

```bash
.\venv\Scripts\Activate.ps1
```

#### Windows (ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ)

```bash
venv\Scripts\activate.bat
```

#### Mac/Linux

```bash
source venv/bin/activate
```

### 5-3. ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆç¢ºèª

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å…ˆé ­ã«`(venv)`ãŒä»˜ã‘ã°OKã§ã™ã€‚

**ä¾‹:**
```
(venv) C:\portfolio\scripts>
```

ã¾ãŸã¯

```
(venv) ~/portfolio/scripts$
```

### 5-4. ãƒ‡ã‚£ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆï¼ˆçµ‚äº†ï¼‰

ä»®æƒ³ç’°å¢ƒã‚’çµ‚äº†ã™ã‚‹ã«ã¯ï¼š

```bash
deactivate
```

---

## ã‚¹ãƒ†ãƒƒãƒ—6: å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 6-1. requirements.txtã®ä½œæˆ

**scripts/requirements.txt**ã‚’ä½œæˆã—ã¾ã™ã€‚

**Claude Codeã§å®Ÿè¡Œ:**

```
scripts/requirements.txt ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€
ä»¥ä¸‹ã®å†…å®¹ã‚’æ›¸ãè¾¼ã‚“ã§ãã ã•ã„ï¼š

ffmpeg-python==0.2.0
```

**ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹:**
```txt
ffmpeg-python==0.2.0
```

### 6-2. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**ä»®æƒ³ç’°å¢ƒãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰:**

```bash
pip install -r requirements.txt
```

**èª¬æ˜:**
- `pip install`: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- `-r requirements.txt`: ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã™ã¹ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 6-3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª

```bash
pip list
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**
```
Package       Version
------------- -------
ffmpeg-python 0.2.0
...
```

---

## ã‚¹ãƒ†ãƒƒãƒ—7: å‹•ç”»åœ§ç¸®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

### 7-1. compress_videos.pyã®ä½œæˆ

**scripts/compress_videos.py**ã‚’ä½œæˆã—ã¾ã™ã€‚

```python
import ffmpeg
import os
import sys
from pathlib import Path

def get_file_size_mb(file_path):
    """ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’MBå˜ä½ã§å–å¾—"""
    size_bytes = os.path.getsize(file_path)
    size_mb = size_bytes / (1024 * 1024)
    return round(size_mb, 2)

def compress_video(input_path, output_path, crf=28):
    """
    å‹•ç”»ã‚’åœ§ç¸®ã™ã‚‹

    Args:
        input_path: å…¥åŠ›å‹•ç”»ã®ãƒ‘ã‚¹
        output_path: å‡ºåŠ›å‹•ç”»ã®ãƒ‘ã‚¹
        crf: åœ§ç¸®å“è³ª (18-28æ¨å¥¨ã€å°ã•ã„ã»ã©é«˜å“è³ª)
    """
    try:
        print(f"åœ§ç¸®é–‹å§‹: {input_path}")
        print(f"å“è³ªè¨­å®š: CRF={crf}")

        # ffmpegã§åœ§ç¸®
        (
            ffmpeg
            .input(input_path)
            .output(
                output_path,
                vcodec='libx264',
                crf=crf,
                preset='medium',
                **{'movflags': '+faststart'}  # Webæœ€é©åŒ–
            )
            .overwrite_output()
            .run(capture_stdout=True, capture_stderr=True)
        )

        # çµæœè¡¨ç¤º
        original_size = get_file_size_mb(input_path)
        compressed_size = get_file_size_mb(output_path)
        reduction = round((1 - compressed_size / original_size) * 100, 1)

        print(f"âœ“ åœ§ç¸®å®Œäº†!")
        print(f"  å…ƒã®ã‚µã‚¤ã‚º: {original_size} MB")
        print(f"  åœ§ç¸®å¾Œ: {compressed_size} MB")
        print(f"  å‰Šæ¸›ç‡: {reduction}%")
        print()

        return compressed_size

    except ffmpeg.Error as e:
        print(f"âœ— ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e.stderr.decode()}")
        return None

def compress_all_videos(video_dir, max_size_mb=100, crf=28):
    """
    ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ã™ã¹ã¦ã®å‹•ç”»ã‚’åœ§ç¸®

    Args:
        video_dir: å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹
        max_size_mb: ç›®æ¨™ã‚µã‚¤ã‚º (MB)
        crf: åœ§ç¸®å“è³ª
    """
    video_dir = Path(video_dir)

    if not video_dir.exists():
        print(f"âœ— ãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {video_dir}")
        return

    # å¯¾å¿œã™ã‚‹å‹•ç”»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    video_extensions = ['.mp4', '.mov', '.avi', '.mkv']

    # å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
    video_files = []
    for ext in video_extensions:
        video_files.extend(video_dir.glob(f'*{ext}'))

    # -compressedãƒ•ã‚¡ã‚¤ãƒ«ã¯é™¤å¤–
    video_files = [f for f in video_files if '-compressed' not in f.stem]

    if not video_files:
        print(f"âœ— å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {video_dir}")
        return

    print(f"è¦‹ã¤ã‹ã£ãŸå‹•ç”»: {len(video_files)}ä»¶")
    print(f"ç›®æ¨™ã‚µã‚¤ã‚º: {max_size_mb} MBä»¥ä¸‹")
    print(f"åœ§ç¸®å“è³ª: CRF={crf}")
    print("=" * 60)
    print()

    # å„å‹•ç”»ã‚’åœ§ç¸®
    for video_file in video_files:
        # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
        current_size = get_file_size_mb(video_file)

        if current_size <= max_size_mb:
            print(f"ã‚¹ã‚­ãƒƒãƒ—: {video_file.name} ({current_size} MB - æ—¢ã«ç›®æ¨™ã‚µã‚¤ã‚ºä»¥ä¸‹)")
            print()
            continue

        # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å
        output_file = video_file.parent / f"{video_file.stem}-compressed{video_file.suffix}"

        # æ—¢ã«åœ§ç¸®æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆ
        if output_file.exists():
            print(f"ã‚¹ã‚­ãƒƒãƒ—: {video_file.name} (åœ§ç¸®æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™)")
            print()
            continue

        # åœ§ç¸®å®Ÿè¡Œ
        compressed_size = compress_video(str(video_file), str(output_file), crf)

        # ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
        if compressed_size and compressed_size > max_size_mb:
            print(f"âš  è­¦å‘Š: ã¾ã {max_size_mb}MBã‚’è¶…ãˆã¦ã„ã¾ã™")
            print(f"  â†’ CRFã‚’ä¸Šã’ã¦å†åœ§ç¸®ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™")
            print()

def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    print("=" * 60)
    print("å‹•ç”»åœ§ç¸®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ")
    print("=" * 60)
    print()

    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹
    # scripts/ã‹ã‚‰è¦‹ã¦ ../public/mov/
    video_dir = Path(__file__).parent.parent / 'public' / 'mov'

    # ã‚«ã‚¹ã‚¿ãƒ è¨­å®š
    MAX_SIZE_MB = 100  # Vercelã®åˆ¶é™
    CRF = 28  # åœ§ç¸®å“è³ª (18-28æ¨å¥¨)

    # åœ§ç¸®å®Ÿè¡Œ
    compress_all_videos(video_dir, MAX_SIZE_MB, CRF)

    print("=" * 60)
    print("å®Œäº†!")
    print("=" * 60)

if __name__ == "__main__":
    main()
```

### 7-2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª¬æ˜

**ä¸»ãªé–¢æ•°:**

1. `get_file_size_mb()`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’è¨ˆç®—
2. `compress_video()`: 1ã¤ã®å‹•ç”»ã‚’åœ§ç¸®
3. `compress_all_videos()`: ãƒ•ã‚©ãƒ«ãƒ€å†…ã®å…¨å‹•ç”»ã‚’ä¸€æ‹¬åœ§ç¸®
4. `main()`: ãƒ¡ã‚¤ãƒ³å‡¦ç†

**åœ§ç¸®è¨­å®š:**
- `crf=28`: åœ§ç¸®å“è³ªï¼ˆå°ã•ã„ã»ã©é«˜å“è³ªã€å¤§ãã„ã»ã©åœ§ç¸®ç‡é«˜ï¼‰
- `preset='medium'`: åœ§ç¸®é€Ÿåº¦
- `movflags='+faststart'`: Webæœ€é©åŒ–ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿå‘ã‘ï¼‰

---

## ã‚¹ãƒ†ãƒƒãƒ—8: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ

### 8-1. å®Ÿè¡Œå‰ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ä»®æƒ³ç’°å¢ƒãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«`(venv)`è¡¨ç¤ºï¼‰
- [ ] `public/mov/`ãƒ•ã‚©ãƒ«ãƒ€ã«å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹
- [ ] ffmpeg-pythonãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

### 8-2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ

**scriptsãƒ•ã‚©ãƒ«ãƒ€å†…ã§:**

```bash
python compress_videos.py
```

### 8-3. å®Ÿè¡Œçµæœã®ä¾‹

```
============================================================
å‹•ç”»åœ§ç¸®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
============================================================

è¦‹ã¤ã‹ã£ãŸå‹•ç”»: 3ä»¶
ç›®æ¨™ã‚µã‚¤ã‚º: 100 MBä»¥ä¸‹
åœ§ç¸®å“è³ª: CRF=28
============================================================

åœ§ç¸®é–‹å§‹: demo-video.mp4
å“è³ªè¨­å®š: CRF=28
âœ“ åœ§ç¸®å®Œäº†!
  å…ƒã®ã‚µã‚¤ã‚º: 150.5 MB
  åœ§ç¸®å¾Œ: 45.2 MB
  å‰Šæ¸›ç‡: 70.0%

ã‚¹ã‚­ãƒƒãƒ—: small-video.mp4 (12.3 MB - æ—¢ã«ç›®æ¨™ã‚µã‚¤ã‚ºä»¥ä¸‹)

åœ§ç¸®é–‹å§‹: project-showcase.mp4
å“è³ªè¨­å®š: CRF=28
âœ“ åœ§ç¸®å®Œäº†!
  å…ƒã®ã‚µã‚¤ã‚º: 200.8 MB
  åœ§ç¸®å¾Œ: 65.4 MB
  å‰Šæ¸›ç‡: 67.4%

============================================================
å®Œäº†!
============================================================
```

### 8-4. åœ§ç¸®å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª

**public/mov/ãƒ•ã‚©ãƒ«ãƒ€:**
```
public/mov/
â”œâ”€â”€ demo-video.mp4              # å…ƒãƒ•ã‚¡ã‚¤ãƒ« (150MB)
â”œâ”€â”€ demo-video-compressed.mp4   # åœ§ç¸®å¾Œ (45MB) â† ä½¿ç”¨
â”œâ”€â”€ small-video.mp4             # å…ƒãƒ•ã‚¡ã‚¤ãƒ« (12MB) - åœ§ç¸®ä¸è¦
â”œâ”€â”€ project-showcase.mp4        # å…ƒãƒ•ã‚¡ã‚¤ãƒ« (200MB)
â””â”€â”€ project-showcase-compressed.mp4  # åœ§ç¸®å¾Œ (65MB) â† ä½¿ç”¨
```

---

## ã‚¹ãƒ†ãƒƒãƒ—9: åœ§ç¸®å“è³ªã®èª¿æ•´

### 9-1. ã¾ã ã‚µã‚¤ã‚ºãŒå¤§ãã„å ´åˆ

**å•é¡Œ:**
```
åœ§ç¸®å¾Œ: 105.3 MB
âš  è­¦å‘Š: ã¾ã 100MBã‚’è¶…ãˆã¦ã„ã¾ã™
```

**è§£æ±ºç­–:** CRFå€¤ã‚’ä¸Šã’ã¦å†åœ§ç¸®

### 9-2. CRFå€¤ã®å¤‰æ›´

**compress_videos.py**ã®è¨­å®šã‚’å¤‰æ›´:

```python
# ã‚«ã‚¹ã‚¿ãƒ è¨­å®š
MAX_SIZE_MB = 100
CRF = 30  # 28 â†’ 30ã«å¤‰æ›´ï¼ˆã‚ˆã‚Šå¼·ãåœ§ç¸®ï¼‰
```

**CRFå€¤ã®ç›®å®‰:**
- `18`: ã»ã¼ç„¡åŠ£åŒ–ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå¤§ï¼‰
- `23`: é«˜å“è³ªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- `28`: ãƒãƒ©ãƒ³ã‚¹ï¼ˆæ¨å¥¨ï¼‰
- `30-32`: å¼·åœ§ç¸®ï¼ˆã‚µã‚¤ã‚ºå„ªå…ˆï¼‰
- `35+`: ä½å“è³ªï¼ˆéæ¨å¥¨ï¼‰

### 9-3. ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘å†åœ§ç¸®

**æ‰‹å‹•ã§å‰Šé™¤ã—ã¦ã‹ã‚‰å†å®Ÿè¡Œ:**

```bash
# åœ§ç¸®æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm public/mov/demo-video-compressed.mp4

# å†å®Ÿè¡Œ
python compress_videos.py
```

---

## ã‚¹ãƒ†ãƒƒãƒ—10: ã‚³ãƒ¼ãƒ‰ã®æ›´æ–°

### 10-1. å‹•ç”»ãƒ‘ã‚¹ã‚’å¤‰æ›´

**app/page.tsx**ï¼ˆã¾ãŸã¯è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰:

```tsx
// å¤‰æ›´å‰
<video src="/mov/demo-video.mp4" />

// å¤‰æ›´å¾Œï¼ˆåœ§ç¸®ç‰ˆã‚’ä½¿ç”¨ï¼‰
<video src="/mov/demo-video-compressed.mp4" />
```

### 10-2. Claude Codeã§ä¸€æ‹¬å¤‰æ›´

```
app/ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ã™ã¹ã¦ã®TSXãƒ•ã‚¡ã‚¤ãƒ«ã§ã€
/mov/xxx.mp4 ã‚’ /mov/xxx-compressed.mp4 ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

ãŸã ã—ã€æ—¢ã«-compressedãŒä»˜ã„ã¦ã„ã‚‹ã‚‚ã®ã¯é™¤å¤–ã—ã¦ãã ã•ã„ã€‚
```

---

## ã‚¹ãƒ†ãƒƒãƒ—11: æ¯å›ä½¿ã†ã‚³ãƒãƒ³ãƒ‰ã¾ã¨ã‚

### 11-1. åŸºæœ¬ãƒ•ãƒ­ãƒ¼

```bash
# 1. scriptsãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•
cd scripts

# 2. ä»®æƒ³ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
# Windows PowerShell:
.\venv\Scripts\Activate.ps1

# Mac/Linux:
source venv/bin/activate

# 3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
python compress_videos.py

# 4. ä»®æƒ³ç’°å¢ƒã‚’çµ‚äº†
deactivate
```

### 11-2. ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ï¼ˆMac/Linuxï¼‰

```bash
cd scripts && source venv/bin/activate && python compress_videos.py && deactivate
```

### 11-3. ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ï¼ˆWindows PowerShellï¼‰

```powershell
cd scripts; .\venv\Scripts\Activate.ps1; python compress_videos.py; deactivate
```

---

## ã‚¹ãƒ†ãƒƒãƒ—12: ä¾¿åˆ©ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 12-1. ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**scripts/check_sizes.py**:

```python
from pathlib import Path
import os

def get_file_size_mb(file_path):
    size_bytes = os.path.getsize(file_path)
    return round(size_bytes / (1024 * 1024), 2)

def check_video_sizes(video_dir, max_size=100):
    video_dir = Path(video_dir)
    video_files = list(video_dir.glob('*.mp4'))

    print("=" * 60)
    print("å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯")
    print("=" * 60)
    print()

    over_limit = []

    for video_file in sorted(video_files):
        size = get_file_size_mb(video_file)
        status = "âœ“ OK" if size <= max_size else "âœ— è¶…é"

        print(f"{status} {video_file.name}: {size} MB")

        if size > max_size:
            over_limit.append((video_file.name, size))

    print()
    print("=" * 60)

    if over_limit:
        print(f"âš  {len(over_limit)}ä»¶ãŒ{max_size}MBã‚’è¶…ãˆã¦ã„ã¾ã™:")
        for name, size in over_limit:
            print(f"  - {name}: {size} MB")
    else:
        print(f"âœ“ ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒ{max_size}MBä»¥ä¸‹ã§ã™!")

    print("=" * 60)

if __name__ == "__main__":
    video_dir = Path(__file__).parent.parent / 'public' / 'mov'
    check_video_sizes(video_dir)
```

**å®Ÿè¡Œ:**
```bash
python check_sizes.py
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1: ä»®æƒ³ç’°å¢ƒã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆãŒã§ããªã„ï¼ˆWindowsï¼‰

**ã‚¨ãƒ©ãƒ¼:**
```
ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡ŒãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹ãŸã‚...
```

**è§£æ±ºç­–:**

PowerShellã‚’ç®¡ç†è€…æ¨©é™ã§é–‹ã:
```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Q2: ffmpeg-pythonã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼:**
```
ERROR: Could not find a version that satisfies the requirement ffmpeg-python
```

**è§£æ±ºç­–:**

1. Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªï¼ˆ3.8ä»¥ä¸Šæ¨å¥¨ï¼‰
2. pipã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ:
```bash
pip install --upgrade pip
```

### Q3: åœ§ç¸®å¾Œã‚‚ã‚µã‚¤ã‚ºãŒå¤§ãã„

**åŸå› :** CRFå€¤ãŒä½ã™ãã‚‹

**è§£æ±ºç­–:**

1. CRFã‚’30-32ã«ä¸Šã’ã‚‹
2. è§£åƒåº¦ã‚’ä¸‹ã’ã‚‹ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹é€ ãŒå¿…è¦ï¼‰
3. YouTube/Vimeoã«ç§»è¡Œ

### Q4: å‹•ç”»ã®ç”»è³ªãŒæ‚ªã™ãã‚‹

**åŸå› :** CRFå€¤ãŒé«˜ã™ãã‚‹

**è§£æ±ºç­–:**

1. CRFã‚’23-26ã«ä¸‹ã’ã‚‹
2. å…ƒã®å‹•ç”»å“è³ªã‚’ç¢ºèª

---

## ã¾ã¨ã‚

### âœ… å­¦ã‚“ã ã“ã¨

- [x] Pythonã®ä»®æƒ³ç’°å¢ƒä½œæˆãƒ»ç®¡ç†
- [x] ffmpeg-pythonã®ä½¿ã„æ–¹
- [x] å‹•ç”»ã®ä¸€æ‹¬åœ§ç¸®è‡ªå‹•åŒ–
- [x] ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ç¢ºèªã¨æœ€é©åŒ–

### ğŸ“ ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

```
scripts/
â”œâ”€â”€ venv/                    # ä»®æƒ³ç’°å¢ƒ
â”œâ”€â”€ compress_videos.py       # åœ§ç¸®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ check_sizes.py           # ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â””â”€â”€ requirements.txt         # ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```

### ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```
1. å‹•ç”»ã‚’ public/mov/ ã«é…ç½®
   â†“
2. scripts/compress_videos.py ã‚’å®Ÿè¡Œ
   â†“
3. åœ§ç¸®å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ-compressed.mp4ï¼‰ã‚’ç¢ºèª
   â†“
4. ã‚³ãƒ¼ãƒ‰å†…ã®å‹•ç”»ãƒ‘ã‚¹ã‚’æ›´æ–°
   â†“
5. ãƒ‡ãƒ—ãƒ­ã‚¤
```

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ã•ã‚‰ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ï¼š

- è§£åƒåº¦ã®è‡ªå‹•èª¿æ•´
- è¤‡æ•°ã®CRFå€¤ã‚’è©¦ã—ã¦æœ€é©å€¤ã‚’æ¢ã™
- åœ§ç¸®å‰å¾Œã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒç”Ÿæˆ
- Slackã‚„Discordã¸ã®é€šçŸ¥æ©Ÿèƒ½

---

## å‚è€ƒãƒªãƒ³ã‚¯

### Pythoné–¢é€£
- [Pythonå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.python.org/ja/3/)
- [venv - ä»®æƒ³ç’°å¢ƒ](https://docs.python.org/ja/3/library/venv.html)

### FFMPEGé–¢é€£
- [ffmpeg-python GitHub](https://github.com/kkroening/ffmpeg-python)
- [FFMPEGå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://ffmpeg.org/documentation.html)
- [CRFè¨­å®šã‚¬ã‚¤ãƒ‰](https://trac.ffmpeg.org/wiki/Encode/H.264#crf)

---

**ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼**

Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã‚‹å‹•ç”»åœ§ç¸®ã®è‡ªå‹•åŒ–ã‚’ç¿’å¾—ã§ãã¾ã—ãŸã€‚ã“ã‚Œã§å¤§é‡ã®å‹•ç”»ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã§ãã¾ã™ã€‚
