# Geminiプロンプト改善とワークフロー更新

**所要時間**: 20分
**難易度**: ⭐⭐⭐☆☆

このモジュールの最後に[ワークフローJSONダウンロード](#ワークフローjsonダウンロード)があります。

---

## このモジュールで学ぶこと

- 改善版Geminiプロンプトの特徴と設計思想
- カテゴリA〜Eの新プロンプト構造
- n8nワークフローへのプロンプト反映方法

---

## 学習目標

このモジュールを終えると、以下のことができるようになります：

- 改善版プロンプトの設計意図を理解できる
- n8nのGeminiノードにプロンプトを設定できる
- カテゴリごとの特性を活かしたコンテンツ生成ができる

---

## 目次

- [セクション1: プロンプト改善の背景](#セクション1-プロンプト改善の背景)
- [セクション2: カテゴリ別プロンプトの特徴](#セクション2-カテゴリ別プロンプトの特徴)
- [セクション3: n8nへのプロンプト反映](#セクション3-n8nへのプロンプト反映)
- [ワークフローJSONダウンロード](#ワークフローjsonダウンロード)
- [トラブルシューティング](#トラブルシューティング)
- [まとめ](#まとめ)
- [よくある質問](#よくある質問)

---

## 事前準備

### 必要なもの

- n8nが稼働している環境
- Google Gemini APIクレデンシャル（設定済み）
- Module 04までのワークフローが完成していること

### 前提知識

- n8nの基本操作
- Geminiノードの使い方

---

## セクション1: プロンプト改善の背景

### 従来のプロンプトの問題点

従来のGeminiプロンプトには以下の問題がありました：

| 問題 | 具体例 |
|------|--------|
| ツール名が勝手に変更される | 「Gemini 3.0」→「Gemini Pro」に置き換えられる |
| 数値が捏造される | 存在しないベンチマークスコアが生成される |
| 絵文字が出力される | キャプションに絵文字が混入 |
| テンプレ感が強い | 「王者vs革命児」のような定型表現 |

### 改善版プロンプトの特徴

これらの問題を解決するため、以下の指示を追加しました：

1. **最重要指示**: 入力データをそのまま使用し、変更禁止
2. **リサーチ禁止**: Web検索を行わず、入力データのみ使用
3. **数値生成禁止**: 具体的な数値・スコアの捏造を禁止
4. **絵文字禁止**: 一切の絵文字使用を禁止

### 6セット構造

従来の12セットから6セット+CTA固定画像に変更しました：

```
Set 1 (0:00-0:05): フック
Set 2 (0:05-0:15): メインコンテンツ1
Set 3 (0:15-0:25): メインコンテンツ2
Set 4 (0:25-0:35): 比較・説明
Set 5 (0:35-0:45): ベネフィット
Set 6 (0:45-0:55): 結論
CTA (0:55-1:00): 固定画像（生成不要）
```

### チェックポイント

- [ ] 従来のプロンプトの問題点を理解した
- [ ] 改善版プロンプトの特徴を理解した
- [ ] 6セット構造を理解した

---

## セクション2: カテゴリ別プロンプトの特徴

### カテゴリA（versus）- 比較動画

2つのツールを比較し、「こういう人はA、こういう人はB」と明確に線引きする構成。

**時系列構造**:
- Set 1: フック - 比較テーマの提示
- Set 2: ツールAの強み
- Set 3: ツールBの強み
- Set 4: 比較ポイント
- Set 5: 使い分け提案
- Set 6: 結論

### カテゴリB（instant_hack）- 時短・効率化

「まだ手作業でやってるの？」という課題提起から始まる時短訴求。

**時系列構造**:
- Set 1: フック - 手作業の無駄を指摘
- Set 2: 課題提起
- Set 3: 解決策
- Set 4: 仕組み・機能
- Set 5: ベネフィット
- Set 6: 結論

### カテゴリC（secret_feature）- 新機能・裏技

「まだ○○してるの？それ古いです」という常識否定から始まる新機能紹介。

**時系列構造**:
- Set 1: フック - 従来の方法を否定
- Set 2: 従来との違い
- Set 3: 動作描写1
- Set 4: 動作描写2
- Set 5: インパクト
- Set 6: 結論

### カテゴリD（warning）- 警告・注意喚起

「警告します」「このままだとヤバいです」という注意喚起から始まるリスク訴求。

**時系列構造**:
- Set 1: フック - 警告の提示
- Set 2: リスク1
- Set 3: リスク2
- Set 4: リスク3
- Set 5: 対策
- Set 6: 結論

### カテゴリE（ranking）- TOP5ランキング

5位から1位へのカウントダウン形式。1位に最も時間を割く特別構造。

**時系列構造**:
- Set 1 (0:00-0:05): フック
- Set 2 (0:05-0:12): 第5位
- Set 3 (0:12-0:20): 第4位
- Set 4 (0:20-0:28): 第3位
- Set 5 (0:28-0:37): 第2位
- Set 6 (0:37-0:50): 第1位（長め）

### チェックポイント

- [ ] 各カテゴリの特徴を理解した
- [ ] カテゴリEの特別な時間配分を理解した

---

## セクション3: n8nへのプロンプト反映

### Step 1: Geminiノードを開く

Switchノードから分岐した各カテゴリのGeminiノードを開きます。

### Step 2: モデルを選択

Modelドロップダウンから`models/gemini-2.5-pro`を選択します。

![Geminiモデル選択](/n8n-advanced/module-05-gemini-model-select.png)

### Step 3: プロンプトを入力

Messagesセクションの「Prompt」フィールドに、対応するカテゴリのプロンプトを貼り付けます。

![Geminiプロンプト入力](/n8n-advanced/module-05-gemini-prompt-input.png)

### Step 4: JSON出力を有効化

以下の設定を確認します：

- **Simplify Output**: ON
- **Output Content as JSON**: ON

### Step 5: 全カテゴリに反映

カテゴリA〜E全てのGeminiノードに対して、同様の手順でプロンプトを設定します。

### 完成したワークフロー

![ワークフロー全体図](/n8n-advanced/module-05-workflow-overview.png)

### チェックポイント

- [ ] Geminiノードでモデルを選択できた
- [ ] プロンプトを貼り付けできた
- [ ] JSON出力設定を確認した

---

## ワークフローJSONダウンロード

以下のJSONファイルをダウンロードしてn8nにインポートできます。

[sns-post-advanced-workflow.json](/n8n-advanced/download/sns-post-advanced-workflow.json)

**インポート後に変更が必要な箇所**:

| プレースホルダー | 変更内容 |
|----------------|---------|
| `YOUR_SPREADSHEET_ID` | あなたのスプレッドシートID |
| `YOUR_SPREADSHEET_NAME` | スプレッドシート名 |
| `YOUR_IDEAS_SHEET_GID` | ideasシートのGID |
| `YOUR_POSTS_SHEET_GID` | postsシートのGID |
| `YOUR_CREDENTIAL_ID` | クレデンシャルID（自動設定される場合あり） |

また、Google SheetsとGoogle Gemini APIのクレデンシャルを設定してください。

---

## トラブルシューティング

### ツール名が変更されてしまう

**症状**: 入力した「Gemini 3.0」が「Gemini Pro」に変更される

**解決方法**: プロンプトの「最重要指示」セクションが正しくコピーされているか確認してください。特に以下の指示が含まれていることを確認：

```
1. 入力データの「タイトル」「ツール」は一切変更せず、そのまま使用すること
2. ツール名やモデル名が不明・最新でも、入力されたものをそのまま出力に使うこと
3. 入力データを「古い」「存在しない」「間違い」と判断して別の名前に置き換えることは絶対禁止
```

### JSON出力がパースできない

**症状**: Parse JSONノードでエラーが発生する

**解決方法**:
1. Geminiノードの「Output Content as JSON」がONになっているか確認
2. プロンプト内のJSON形式の例が正しくエスケープされているか確認

---

## まとめ

### このモジュールで学んだこと

- 従来プロンプトの問題点と改善版の特徴
- カテゴリA〜Eそれぞれの時系列構造
- n8nへのプロンプト反映手順

### 次のステップ

- 実際にワークフローを実行して生成結果を確認
- 生成されたコンテンツの品質検証
- 必要に応じてプロンプトの微調整

---

## 参考資料

- [Google AI Studio](https://aistudio.google.com/)
- [Gemini API Documentation](https://ai.google.dev/docs)

---

## よくある質問

**Q: Gemini 2.5 FlashとProの違いは？**
A: Proの方が指示遵守度が高く、品質が安定しています。Flashはコストが低いですが、指示を無視することがあります。本講座ではProを推奨しています。

**Q: プロンプトをカスタマイズしてもいい？**
A: はい。ただし「最重要指示」と「禁止事項」のセクションは変更しないでください。これらを変更すると、ツール名の変更や数値捏造が発生する可能性があります。

**Q: キャプションのテンプレート部分は変更できる？**
A: はい。キャプションテンプレートの前半（見出し1〜3）は動的に生成されますが、後半の固定部分（コミュニティ紹介など）は自由に変更できます。

**Q: なぜ6セット構造なの？**
A: 60秒動画に対して12セットは情報過多でした。6セット+CTA固定画像の構成により、各セットに十分な表示時間を確保できます。

**Q: ランキング（カテゴリE）の時間配分が違うのはなぜ？**
A: ランキング動画では1位が最も重要なため、1位に約13秒を割り当てています。これにより視聴者の期待感を高め、最後まで見てもらいやすくなります。
