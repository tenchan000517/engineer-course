# Instagram API セットアップガイド

**所要時間**: 45-60分
**難易度**: ⭐⭐⭐☆☆

---

## このモジュールで学ぶこと

- Meta for Developers（Facebook開発者）への登録方法
- Facebookページの作成とInstagramアカウントの連携
- Instagram Graph APIを使うためのアプリ作成
- アクセストークンの取得方法

---

## 学習目標

このモジュールを終えると、以下のことができるようになります：

- FacebookページとInstagramプロアカウントを連携できる
- Meta for Developersでアプリを作成できる
- Instagram APIに必要な権限を設定できる
- n8nで使用するアクセストークンを取得できる

---

## 事前準備

### 必要なもの
- Instagramプロアカウント（ビジネスまたはクリエイター）
- Facebookアカウント
- クレジットカード（本人確認用、課金はされません）
- 安定したインターネット接続

### 推奨環境
- PC（Windows/Mac/Linux）
- ブラウザ（Chrome推奨）

### 事前確認
- [ ] Instagramアカウントが「プロアカウント」に切り替え済み
- [ ] Instagramアカウントが「公開」設定になっている

---

## セクション1: Facebookページの作成

### Facebookページとは

Instagram Graph APIを使用するには、InstagramプロアカウントをFacebookページに連携する必要があります。Facebookページはビジネス用のFacebookアカウントで、個人アカウントとは別に作成します。

### 作成手順

1. [Facebook](https://www.facebook.com/) にログイン
2. 左側メニューから「ページ」をクリック
3. 「新しいページを作成」をクリック
4. 以下を入力：
   - **ページ名**: 任意（例: 天ちゃんの0から始めるエンジニア生活）
   - **カテゴリ**: 任意（例: 教育）
5. 「ページを作成」をクリック

### チェックポイント

- [ ] Facebookページが作成された
- [ ] ページ名が正しく設定された

---

## セクション2: InstagramとFacebookページの連携

### Meta Business Suiteにアクセス

1. [Meta Business Suite](https://business.facebook.com/) にアクセス
2. 作成したFacebookページでログイン

### Instagramアカウントを連携

1. 左メニューの「設定」をクリック
2. 「リンク済みアカウント」または「Instagram」を選択
3. 「Instagramアカウントをリンク」をクリック
4. Instagramの認証情報を入力してログイン
5. 連携を許可

### 連携確認

連携が完了すると、以下のような表示になります：

```
ページにリンク済みのInstagram
[Instagramユーザー名]
Instagramアカウント「[ユーザー名]」がFacebookページ「[ページ名]」にリンクされました。
リンクされたこれらのプロフィールは、ビジネスポートフォリオ内に含まれています。
```

### チェックポイント

- [ ] Meta Business Suiteにアクセスできた
- [ ] InstagramアカウントがFacebookページに連携された
- [ ] 「ビジネスポートフォリオ内に含まれています」と表示された

---

## セクション3: Meta for Developers 登録

### 開発者サイトにアクセス

1. **新しいブラウザ** または **シークレットウィンドウ** を開く
2. [developers.facebook.com](https://developers.facebook.com/) にアクセス
3. Facebookアカウントでログイン

> **重要**: Meta Business Suiteにログイン中のブラウザだとリダイレクトされることがあります。別ブラウザで直接アクセスしてください。

### 開発者登録画面

初回アクセス時、以下の画面が表示されます：

![Meta for Developers 登録画面](/n8n-setup/04-developer-register.png)

登録の流れ：
1. **Register（登録）**
2. **Verify account（アカウント確認）**
3. **Contact info（連絡先情報）**
4. **About you（自己紹介）**

「次へ」をクリックして進みます。

### アカウント認証

![電話番号認証画面](/n8n-setup/05-phone-verify.png)

認証方法は2つあります：

| 方法 | 説明 |
|------|------|
| 電話番号 | SMSで認証コードを受信 |
| クレジットカード | カード情報で本人確認（課金なし） |

**電話番号認証でエラーが出る場合**は、画面下部の「クレジットカードを追加して、アカウントを認証することもできます。」をクリックして、クレジットカード認証を使用してください。

### 開発者タイプの選択

「開発者」「マーケター」などの選択肢が表示されます。自分に近いものを選択してください（どれを選んでも機能に違いはありません）。

### 登録完了

登録が完了すると、開発者ダッシュボードが表示されます：

![開発者ダッシュボード](/n8n-setup/06-developer-dashboard.png)

「アプリはまだありません」と表示されていればOKです。

### チェックポイント

- [ ] developers.facebook.comにアクセスできた
- [ ] アカウント認証が完了した
- [ ] 開発者ダッシュボードが表示された

---

## セクション4: アプリの作成

### アプリ作成を開始

1. ダッシュボードの「アプリを作成」をクリック

### アプリの詳細を入力

![アプリ作成画面](/n8n-setup/07-app-create-details.png)

1. **アプリ名**: 任意の名前を入力
   - 例: `social-post-workflow`
   - **注意**: 「instagram」「facebook」などのMeta商標は使用不可

2. **アプリの連絡先メールアドレス**: 受信可能なアドレスを確認

3. 「次へ」をクリック

### ユースケースの選択

![ユースケース選択画面](/n8n-setup/08-usecase-content.png)

1. 左側のフィルターで **「コンテンツ管理」** をクリック
2. **「Instagramでメッセージとコンテンツを管理」** にチェックを入れる
   - 「Instagram APIで投稿の公開、ストーリーズのシェア、コメントへの返信、ダイレクトメッセージへの回答などができます。」
3. 「次へ」をクリック

### ビジネスポートフォリオの選択

![ビジネスポートフォリオ選択](/n8n-setup/09-business-portfolio.png)

1. セクション2で作成したビジネスポートフォリオを選択
2. 「次へ」をクリック

### 公開の要件

「要件を特定できませんでした」と表示される場合はそのまま「次へ」をクリック。

### 概要確認

![概要確認画面](/n8n-setup/10-app-summary.png)

設定内容を確認します：

| 項目 | 内容 |
|------|------|
| アプリ名 | 入力した名前 |
| メールアドレス | 連絡先メール |
| ユースケース | Instagramでメッセージとコンテンツを管理 |
| ビジネス | 選択したビジネスポートフォリオ |

確認したら「ダッシュボードに移動」をクリック。

> **注意**: パスワードの再入力を求められる場合があります。

### アプリダッシュボード

![アプリダッシュボード](/n8n-setup/11-app-dashboard.png)

アプリが作成され、ダッシュボードが表示されます。「アプリダッシュボードへようこそ」のポップアップは「完了」で閉じてOKです。

### チェックポイント

- [ ] アプリ名を設定した（Meta商標を含まない）
- [ ] 「Instagramでメッセージとコンテンツを管理」を選択した
- [ ] ビジネスポートフォリオを選択した
- [ ] アプリダッシュボードが表示された

---

## セクション5: Instagramテスターの追加

アクセストークンを取得する前に、Instagramアカウントを「テスター」として追加する必要があります。

### アプリの役割設定

![アプリの役割画面](/n8n-setup/15-app-roles.png)

1. 左メニューの「アプリの役割」をクリック
2. 「役割」を選択
3. 右上の **「メンバーを...」** ボタンをクリック

### Instagramテスターを追加

![Instagramテスター追加](/n8n-setup/16-add-instagram-tester.png)

「アプリに人を追加」ダイアログが表示されます：

1. **「Instagramテスター」** を選択
   - 「Instagram Basic Display APIで必要なすべてのアクセス許可、機能、および製品をテストできます」
2. 「追加」をクリック
3. Instagramのユーザー名を入力して追加

### Instagram側で招待を承認

1. Instagramアプリを開く
2. プロフィール → 設定 → アプリとウェブサイト → テスター招待
3. 招待を「承認」

### 追加完了の確認

![Instagramテスター追加完了](/n8n-setup/17-tester-added.png)

アプリの役割画面に、Instagramテスターとして追加されたアカウントが表示されます。

### チェックポイント

- [ ] 「アプリの役割」→「メンバーを...」から追加した
- [ ] 「Instagramテスター」を選択した
- [ ] Instagram側で招待を承認した
- [ ] 役割画面にInstagramテスターが表示された

---

## セクション6: ユースケースのカスタマイズ

### ユースケース画面へ

![ユースケース画面](/n8n-setup/12-usecase-list.png)

1. 左メニューの「ユースケース」をクリック
2. 「Instagramでメッセージとコンテンツを管理」の **「カスタマイズ」** をクリック

### Instagram API設定画面

![Instagram APIカスタマイズ画面](/n8n-setup/13-instagram-api-customize.png)

この画面で以下の設定を行います：

1. 必要なメッセージアクセス許可を追加する
2. アクセストークンを生成する
3. Webhooksを設定する（n8n投稿には不要）
4. Instagramビジネスログインを設定する
5. アプリレビューを完了する（テストモードでは不要）

### チェックポイント

- [ ] ユースケースの「カスタマイズ」をクリックした
- [ ] Instagram API設定画面が表示された

---

## セクション7: アクセストークンの取得

### 権限の追加

「1. 必要なメッセージアクセス許可を追加する」セクションで：

1. **「Add all required permissions」** ボタンをクリック

以下の権限が追加されます：
- `instagram_business_basic`
- `instagram_manage_comments`
- `instagram_business_manage_messages`

### アクセストークンの生成

「2. アクセストークンを生成する」セクションで：

![トークン生成準備](/n8n-setup/18-token-generate-ready.png)

Instagramアカウントが表示されています。

1. **「トークンを生成」** をクリック

### Instagramアカウント追加のポップアップ

![アカウント追加ポップアップ](/n8n-setup/14-add-account-popup.png)

- 追加できるのはInstagramプロアカウントのみ
- トークンは公開Instagramアカウント用にのみ生成可能

「次へ」をクリックすると、Instagramログイン画面が表示されます。

### 権限の許可

![Instagram権限許可画面](/n8n-setup/19-instagram-permissions.png)

Instagramの権限許可画面が表示されます。**すべての権限をONにしてください**：

| 権限 | 状態 |
|------|------|
| メッセージへのアクセスを許可 | ON |
| プロフィールの表示とメディアへのアクセス（必須） | ON |
| コメントへのアクセスと管理 | ON |
| メッセージへのアクセスと管理 | ON |
| **コンテンツへのアクセスと公開** | **ON（必須）** |
| インサイトへのアクセスと管理 | ON |

> **重要**: 「コンテンツへのアクセスと公開」をONにしないとInstagramに投稿できません。

すべてONにしたら「許可」をクリック。

### トークンの保存

![トークン生成完了](/n8n-setup/20-token-generated.png)

トークンが生成されると、以下の画面が表示されます：

```
トークンが生成されました

アクセストークン
XXXXX●●●●●●●●●●●●●●●●●●●●●●●●
```

1. **「理解しました」** にチェック
2. **「コピー」** ボタンをクリック
3. **安全な場所に保存**（メモ帳、パスワードマネージャーなど）
4. 「完了」をクリック

> **重要**: このトークンは一度しか表示されません。なくした場合は再生成が必要です。

### チェックポイント

- [ ] 「Add all required permissions」で権限を追加した
- [ ] 「トークンを生成」をクリックした
- [ ] Instagramにログインして権限を許可した
- [ ] 「コンテンツへのアクセスと公開」をONにした
- [ ] アクセストークンをコピーして安全に保存した

---

## トラブルシューティング

### developers.facebook.comで「アクセス権がありません」エラー

![アクセス権エラー](/n8n-setup/21-error-no-access.jpg)

**症状**: developers.facebook.comにアクセスすると「アクセス権がありません。この機能はまだ利用できません。」と表示される

**原因**: Meta Business Suiteにログイン中のブラウザでアクセスするとリダイレクトされる

**解決方法**:
- 別のブラウザで直接 `developers.facebook.com` にアクセス
- またはシークレットウィンドウを使用

---

### 電話番号認証で「一時的なエラー」

**症状**: 開発者登録時の電話番号認証で「一時的なエラーが発生しました」と表示される

**解決方法**:
- 「クレジットカードを追加して、アカウントを認証することもできます」のリンクをクリック
- クレジットカードで認証（実際に課金はされません）

---

### アプリ名に「instagram」が使えない

**症状**: アプリ名入力時に「『instagram』のような用語は使用できません」と表示される

**原因**: Meta商標・ブランド関連の用語（FB、Face、Book、Insta、Gram等）は禁止

**解決方法**: 別の名前を使用
- 例: `social-post-workflow`、`my-social-app`

---

### 「開発者の役割が不十分です」エラー

![開発者の役割エラー](/n8n-setup/22-error-insufficient-role.png)

**症状**: トークン生成時にInstagramログイン後「開発者の役割が不十分です」と表示される

**原因**: Instagramアカウントがテスターとして追加されていない

**解決方法**:
1. 「アプリの役割」→「役割」に移動
2. 「メンバーを...」ボタンをクリック
3. 「Instagramテスター」を選択して追加
4. Instagram側で招待を承認
5. 再度トークン生成を試す

---

## まとめ

### このモジュールで学んだこと

- FacebookページとInstagramプロアカウントの連携方法
- Meta for Developersへの登録手順
- Instagram APIを使うためのアプリ作成方法
- Instagramテスターの追加方法
- アクセストークンの取得方法

### 次のステップ

次のモジュールでは、取得したアクセストークンを使って、n8nでInstagramに自動投稿するワークフローを構築します。

---

## 参考資料

- [Meta for Developers](https://developers.facebook.com/)
- [Instagram Graph API ドキュメント](https://developers.facebook.com/docs/instagram-api/)
- [n8n Community: Step-by-Step Guide to Post to Instagram](https://community.n8n.io/t/step-by-step-guide-how-to-post-to-instagram-via-n8n-automations/61665)

---

## よくある質問

**Q: テストモードのままでずっと使えますか？**
A: はい。自分のInstagramアカウントに投稿するだけなら、アプリを公開する必要はありません。テストモードで永続的に使用できます。

**Q: アクセストークンに有効期限はありますか？**
A: テストモードで生成したトークンは長期間有効ですが、権限の変更やアプリ設定の変更で無効になる場合があります。その場合は再生成してください。

**Q: 複数のInstagramアカウントで使えますか？**
A: はい。「アカウントを追加」から追加のInstagramアカウントを連携し、それぞれのトークンを取得できます。

**Q: Facebookページは公開する必要がありますか？**
A: いいえ。Facebookページは公開していなくても、Instagram APIの連携には影響しません。

**Q: 「コンテンツへのアクセスと公開」をOFFにしてしまいました。**
A: 「ユースケース」→「カスタマイズ」→「トークンを生成」から再度ログインし、権限を許可し直してください。
